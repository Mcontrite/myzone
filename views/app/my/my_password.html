{{ template "layout/header" .}}
<!-- ==================== contact-section start ==================== -->
<section id="contact-section" class="contact-section w100dt mb-50">
	<div class="container">
		<div class="row">
			<div class="col m9 s12">
				<div class="sidebar-title left-align">
					<a href="/my.html"><h2>个人资料</h2></a>
				</div>
				<div class="contact-me">
					<div class="row">
						<div class="col m6 s12">
							<div class="ppic left">
								<img src="{{.sessions.Useravatar}}" alt="Image">
								<h4>{{.sessions.Username}}</h4>
							</div>
							<div class="contact-things">
								
								<div class="c-text p-0">
									<form action="/api/user/{{.sessions.Userid}}/password/reset" method="post" id="reset_form">
										<div class="form-group input-group">
											<div class="input-group-prepend">
												<span class="input-group-text"><i class="icon-lock"></i></span>
											</div>
											<input type="password" class="form-control" id="password_old" name="password_old" placeholder="旧密码" required="">
											<div class="invalid-feedback"></div>
										</div>
										<div class="form-group input-group">
											<div class="input-group-prepend">
												<span class="input-group-text"><i class="icon-lock"></i></span>
											</div>
											<input type="password" class="form-control" id="password_new" name="password_new" placeholder="新密码" required="">
											<div class="invalid-feedback"></div>
										</div>
										<div class="form-group input-group">
											<div class="input-group-prepend">
												<span class="input-group-text"><i class="icon-lock"></i></span>
											</div>
											<input type="password" class="form-control" id="password_new_repeat" name="password_new_repeat" placeholder="重复新密码"
											 required="">
											<div class="invalid-feedback"></div>
										</div>
										<div>
											<button type="button" class="btn btn-primary btn-block" id="submit" data-loading-text="正在提交...">修改密码</button>
										</div>
									</form>					
								</div>
							</div>
						</div>
						<!-- colsm6 -->
					</div>
					<!-- row -->
				</div>
				<!-- /.contact-me -->
			</div>
			<!-- colm9 -->
			
			
		</div>
		<!-- row -->
	</div>
	<!-- container -->
</section>
<!-- /#contact-section -->
<!-- ==================== contact-section end ==================== -->

<script>
	var qrform = $("#reset_form")
	var jsubmit = $('#submit');
	jsubmit.on('click', function() {
		var oldpass = $("#password_old").val().trim()
		var newpass = $("#password_new").val().trim()
		var repnewpass = $("#password_new_repeat").val().trim()
		if (oldpass.length == 0 || newpass.length == 0) {
			$.alert("密码不能为空")
			return
		}
		if (newpass != repnewpass) {
			$.alert("两次输入的密码不同，请重新输入")
			return
		}
		qrform.reset();
		jsubmit.button('loading');
		var replydata = qrform.serializeObject();
		console.log(replydata)
		$.xpost(qrform.attr('action'), replydata, function(code, message) {
			console.log(code, ":", message)
			if (code == 200) {
				$.alert("修改成功")
				setTimeout(function() {
					location.reload()
				}, 1000)
			} else {
				$.alert("修改失败")
				jsubmit.button('reset');
			}
		});
		return false;
	});
</script>
{{ template "layout/footer" .}}
